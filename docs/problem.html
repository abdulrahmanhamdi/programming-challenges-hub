<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Problem Viewer | Coding Hub</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css">

    <link rel="stylesheet" href="assets/css/global.css">
    <link rel="stylesheet" href="assets/css/theme.css">
    <link rel="stylesheet" href="assets/css/components.css">
    <link rel="stylesheet" href="assets/css/markdown.css">
    <link rel="stylesheet" href="assets/css/code.css">

    <style>
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø³Ø§ÙŠØ¯Ø¨Ø§Ø± Ù„Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© */
        @media (min-width: 992px) {
            body { padding-left: 280px; }
            #sidebar { left: 0; width: 280px; }
        }
        @media (max-width: 991px) {
            #sidebar { display: none; } 
        }
        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù†Ø´Ø· ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© */
        .list-group-item.active {
            background-color: #0d6efd;
            border-color: #0d6efd;
        }
        /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø© */
        .hidden { display: none !important; }
    </style>
</head>

<body class="bg-light">

    <nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html">Coding Hub</a>
            <div class="d-flex align-items-center gap-2 ms-auto">
                <a href="problems.html" class="btn btn-sm btn-outline-light d-lg-none">List</a>
                <button class="btn btn-light btn-sm" onclick="toggleTheme()">ğŸŒ™ / â˜€ï¸</button>
            </div>
        </div>
    </nav>

    <div id="sidebar" class="bg-white border-end shadow-sm" style="position: fixed; top: 0; bottom: 0; overflow-y: auto; padding-top: 60px; z-index: 1000;">
        <div class="p-3">
            <h6 class="text-uppercase text-muted fw-bold mb-3 ps-2" style="font-size: 0.8rem;">Problem Explorer</h6>
            
            <input type="text" id="sidebarFilter" class="form-control form-control-sm mb-3" placeholder="Filter list...">
            
            <div id="sidebarList" class="list-group list-group-flush">
                <div class="text-center text-muted small py-4">
                    <div class="spinner-border spinner-border-sm text-primary" role="status"></div>
                    <div class="mt-2">Loading problems...</div>
                </div>
            </div>
        </div>
    </div>

    <div class="container mt-4 mb-5 animate-fade" style="max-width: 900px;">

        <div id="problemHeader" class="d-flex justify-content-between align-items-start border-bottom pb-3 mb-4 hidden">
            <div>
                <h2 id="problemTitleDisplay" class="fw-bold mb-2">Loading...</h2>
                <span id="difficultyBadge" class="badge bg-secondary">...</span>
            </div>
            <button id="favButton" class="fav-btn" title="Add to Favorites">â˜…</button>
        </div>

        <div id="problemContent">
            <div class="text-center py-5 text-muted">
                <div class="display-1 mb-3">ğŸ‘ˆ</div>
                <h3>Select a problem to start coding</h3>
                <p>Choose a challenge from the sidebar list to view details.</p>
            </div>
        </div>

        <div id="actionArea" class="hidden">
            <div class="card bg-white border mt-5 shadow-sm">
                <div class="card-body d-flex justify-content-between align-items-center flex-wrap gap-2">
                    <span class="text-muted fw-medium">Stuck? Check the solution.</span>
                    <a id="solutionLink" href="#" class="btn btn-success px-4">
                        View Solution <span class="ms-1">â†’</span>
                    </a>
                </div>
            </div>

            <hr class="my-5">

            <div class="d-flex justify-content-between">
                <button id="prevBtn" class="btn btn-outline-secondary px-4">â† Previous</button>
                <button id="nextBtn" class="btn btn-outline-secondary px-4">Next â†’</button>
            </div>
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>

    <script src="assets/js/config.js"></script>
    <script src="assets/js/core.js"></script>
    <script src="assets/js/favorites.js"></script>

    <script>
        let PROBLEMS = [];
        let CURRENT_INDEX = -1;
        const urlParams = new URLSearchParams(window.location.search);
        const problemPath = urlParams.get('id');

        async function init() {
            // 1. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹ (Ø¯Ø§Ø¦Ù…Ø§Ù‹)
            await loadIndex();

            // 2. Ø¥Ø°Ø§ ÙˆØ¬Ø¯ Ø±Ø§Ø¨Ø· Ù…Ø³Ø£Ù„Ø©ØŒ Ù†Ù‚ÙˆÙ… Ø¨ØªØ­Ù…ÙŠÙ„Ù‡Ø§. ÙˆØ¥Ù„Ø§ØŒ Ù†Ø¨Ù‚Ù‰ ÙÙŠ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨.
            if (problemPath) {
                loadContent();
            }
        }

        // Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙ‡Ø±Ø³ ÙˆØ¨Ù†Ø§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        async function loadIndex() {
            try {
                const res = await fetch(CONFIG.PROBLEMS_INDEX);
                const text = await res.text();
                const lines = text.split("\n").filter(l => l.startsWith("| ") && l.includes(".md"));
                
                PROBLEMS = lines.map((line, index) => {
                    const parts = line.split("|");
                    return {
                        index: index,
                        title: parts[1].trim(),
                        difficulty: parts[2].trim().toLowerCase(),
                        link: parts[3].match(/\((.*)\)/)[1],
                        slug: parts[3].match(/\((.*)\)/)[1].split("/").pop().replace(".md", "")
                    };
                });

                renderSidebar(PROBLEMS);
                
                // ØªÙØ¹ÙŠÙ„ ÙÙ„ØªØ± Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø³Ø§ÙŠØ¯Ø¨Ø§Ø±
                document.getElementById("sidebarFilter").addEventListener("input", (e) => {
                    const term = e.target.value.toLowerCase();
                    const filtered = PROBLEMS.filter(p => p.title.toLowerCase().includes(term));
                    renderSidebar(filtered);
                });

            } catch (err) {
                document.getElementById("sidebarList").innerHTML = `<div class="text-danger small p-3">Error loading index.</div>`;
            }
        }

        // Ø±Ø³Ù… Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
        function renderSidebar(list) {
            const sidebar = document.getElementById("sidebarList");
            if(list.length === 0) {
                sidebar.innerHTML = "<div class='text-muted small p-3'>No problems found.</div>";
                return;
            }
            
            sidebar.innerHTML = list.map(p => {
                // ØªÙ…ÙŠÙŠØ² Ø§Ù„Ù…Ø³Ø£Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                const isActive = (p.link === problemPath);
                const activeClass = isActive ? "active text-white" : "text-dark";
                
                // Ø£Ù„ÙˆØ§Ù† Ø§Ù„ØµØ¹ÙˆØ¨Ø© (Ù†Ù‚Ø·Ø© ØµØºÙŠØ±Ø©)
                const diffColor = p.difficulty === 'easy' ? 'text-success' : p.difficulty === 'medium' ? 'text-warning' : 'text-danger';
                const dotClass = isActive ? "text-white-50" : diffColor;

                return `
                <a href="problem.html?id=${p.link}" class="list-group-item list-group-item-action border-0 rounded mb-1 ${activeClass}">
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="small fw-medium text-truncate" style="max-width: 180px;">${p.title}</span>
                        <span style="font-size: 12px;" class="${dotClass}">â—</span>
                    </div>
                </a>`;
            }).join("");
        }

        // Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø³Ø£Ù„Ø©
        async function loadContent() {
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø®ÙÙŠØ©
            document.getElementById("problemHeader").classList.remove("hidden");
            document.getElementById("actionArea").classList.remove("hidden");
            
            const fetchPath = "../" + problemPath;
            
            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø³Ø£Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            CURRENT_INDEX = PROBLEMS.findIndex(p => p.link === problemPath);
            updateNavButtons();

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙÙˆØ±Ø§Ù‹ Ù…Ù† Ø§Ù„ÙÙ‡Ø±Ø³ (Ø£Ø³Ø±Ø¹ Ù…Ù† Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ù„Ù)
            if(CURRENT_INDEX !== -1) {
                const p = PROBLEMS[CURRENT_INDEX];
                document.getElementById("problemTitleDisplay").innerText = p.title;
                document.getElementById("solutionLink").href = `solution.html?slug=${p.slug}`;
                
                const badge = document.getElementById("difficultyBadge");
                badge.innerText = p.difficulty.toUpperCase();
                badge.className = `badge ${p.difficulty === 'easy' ? 'bg-success' : p.difficulty === 'medium' ? 'bg-warning text-dark' : 'bg-danger'}`;
                
                setupFavButtonInPage(p);
            }

            // Ø¬Ù„Ø¨ Ù…Ù„Ù Ø§Ù„Ù…Ø§Ø±ÙƒØ¯ÙˆÙ†
            try {
                const res = await fetch(fetchPath);
                if(!res.ok) throw new Error("Not Found");
                const md = await res.text();
                
                document.getElementById("problemContent").innerHTML = marked.parse(md);
                document.querySelectorAll("pre code").forEach(el => hljs.highlightElement(el));
                addCopyButtons(); 

            } catch (e) {
                document.getElementById("problemContent").innerHTML = `
                    <div class="alert alert-danger text-center mt-5">
                        <h4>Problem File Not Found</h4>
                        <p>Could not load: ${fetchPath}</p>
                    </div>`;
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„
        function updateNavButtons() {
            const prevBtn = document.getElementById("prevBtn");
            const nextBtn = document.getElementById("nextBtn");

            prevBtn.disabled = (CURRENT_INDEX <= 0);
            nextBtn.disabled = (CURRENT_INDEX === -1 || CURRENT_INDEX >= PROBLEMS.length - 1);

            if(!prevBtn.disabled) {
                prevBtn.onclick = () => location.href = `problem.html?id=${PROBLEMS[CURRENT_INDEX - 1].link}`;
            }
            if(!nextBtn.disabled) {
                nextBtn.onclick = () => location.href = `problem.html?id=${PROBLEMS[CURRENT_INDEX + 1].link}`;
            }
        }

        // Ø¥Ø¶Ø§ÙØ© Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù†Ø³Ø®
        function addCopyButtons() {
            document.querySelectorAll("pre").forEach(pre => {
                const btn = document.createElement("button");
                btn.className = "copy-btn";
                btn.innerText = "Copy";
                btn.onclick = () => {
                    navigator.clipboard.writeText(pre.innerText);
                    btn.innerText = "Copied!";
                    setTimeout(() => btn.innerText = "Copy", 1500);
                };
                pre.style.position = "relative";
                pre.appendChild(btn);
            });
        }

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø²Ø± Ø§Ù„Ù…ÙØ¶Ù„Ø©
        function setupFavButtonInPage(problemObj) {
            const btn = document.getElementById("favButton");
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø§Ù„Ø©
            btn.classList.remove("active");
            
            if (isFavorite(problemObj.slug)) btn.classList.add("active");
            
            btn.onclick = () => {
                toggleFavorite(problemObj);
                btn.classList.toggle("active");
            };
        }

        init();
    </script>
</body>
</html>